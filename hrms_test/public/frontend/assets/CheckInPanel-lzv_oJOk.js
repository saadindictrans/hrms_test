import{i as g,a as k,O as U,a3 as q,c as M,e as z,a4 as A,f as j,j as c,k as u,q as a,t as n,v as o,F as N,l as b,n as d,a5 as x,x as G,y as D,A as J,ae as V}from"./frappe-ui-qLvTFYQB.js";import{c as K,m as Q}from"./index-CEKosOWR.js";import{a as W}from"./formatters-Ct4yxM4M.js";const X={class:"flex flex-col bg-white rounded w-full py-6 px-4 border-none"},Z={class:"text-lg font-bold text-gray-900"},ee={key:0,class:"font-medium text-sm text-gray-500 mt-1.5"},te=["onClick"],oe={key:1,class:"font-medium text-sm text-gray-500 mt-1.5"},ae={class:"h-120 w-full flex flex-col items-center justify-center gap-5 p-4 mb-5"},se={class:"flex flex-col gap-1.5 mt-2 items-center justify-center"},ne={class:"font-bold text-xl"},le={class:"font-medium text-gray-500 text-sm"},ie={key:0,class:"font-medium text-gray-500 text-sm"},ce={class:"rounded border-4 translate-z-0 block overflow-hidden w-full h-170"},re=["src"],w="Employee Checkin",fe={__name:"CheckInPanel",setup(ue){const m=g("$socket"),C=g("$employee"),_=g("$dayjs"),t=g("$translate"),Y=k(null),p=k(0),f=k(0),l=k(""),h=U({url:"hrms.api.get_hr_settings",auto:!0}),r=q({doctype:w,fields:["name","employee","employee_name","log_type","time","device_id"],filters:{employee:C.data.name},orderBy:"time desc"});r.reload();const s=M(()=>r.list.loading||!r.data?{}:r.data[0]),O=M(()=>{var e;return((e=s==null?void 0:s.value)==null?void 0:e.log_type)==="IN"?"check-in":"check-out"}),y=M(()=>{var e;return((e=s==null?void 0:s.value)==null?void 0:e.log_type)==="IN"?{action:"OUT",label:t("Check Out")}:{action:"IN",label:t("Check In")}});function R(e){p.value=e.coords.latitude,f.value=e.coords.longitude,l.value=[t("Latitude: {0}Â°",[Number(p.value).toFixed(5)]),t("Longitude: {0}Â°",[Number(f.value).toFixed(5)])].join(", ")}function S(e){l.value="Unable to retrieve your location",e&&(l.value+=`: ERROR(${e.code}): ${e.message}`)}const T=()=>{navigator.geolocation?(l.value=t("Locating..."),navigator.geolocation.getCurrentPosition(R,S)):l.value=t("Geolocation is not supported by your current browser")},F=()=>{var e;Y.value=_().format("YYYY-MM-DD HH:mm:ss"),(e=h.data)!=null&&e.allow_geolocation_tracking&&T()},H=e=>{const i=t(e==="IN"?"Check-in":"Check-out");r.insert.submit({employee:C.data.name,log_type:e,time:Y.value,latitude:p.value,longitude:f.value},{onSuccess(){Q.dismiss(),V({title:t("Success"),text:t("{0} successful!",[i]),icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){V({title:t("Error"),text:t("{0} failed!",[i]),icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}})};return z(()=>{m.emit("doctype_subscribe",w),m.on("list_update",e=>{e.doctype==w&&r.reload()})}),A(()=>{m.emit("doctype_unsubscribe",w),m.off("list_update")}),(e,i)=>{var $,E,B,I;const P=j("router-link"),L=j("Button");return c(),u(N,null,[a("div",X,[a("h2",Z,n(o(t)("Hey, {0} ðŸ‘‹",[(E=($=o(C))==null?void 0:$.data)==null?void 0:E.first_name])),1),(B=o(h).data)!=null&&B.allow_employee_checkin_from_mobile_app?(c(),u(N,{key:0},[s.value?(c(),u("div",ee,[a("span",null,n(o(t)("Last {0} was at {1}",[o(t)(O.value),o(W)(s.value.time)])),1),i[1]||(i[1]=a("span",{class:"whitespace-pre"}," Â· ",-1)),b(P,{to:{name:"EmployeeCheckinListView"}},{default:d(({navigate:v})=>[a("span",{onClick:v,class:"underline"},"View List",8,te)]),_:1})])):x("",!0),b(L,{class:"mt-4 mb-1 drop-shadow-sm py-5 text-base",id:"open-checkin-modal",onClick:F},{prefix:d(()=>[b(o(G),{name:y.value.action==="IN"?"arrow-right-circle":"arrow-left-circle",class:"w-4"},null,8,["name"])]),default:d(()=>[D(" "+n(y.value.label),1)]),_:1})],64)):(c(),u("div",oe,n(o(_)().format("ddd, D MMMM, YYYY")),1))]),(I=o(h).data)!=null&&I.allow_employee_checkin_from_mobile_app?(c(),J(o(K),{key:0,ref:"modal",trigger:"open-checkin-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:d(()=>{var v;return[a("div",ae,[a("div",se,[a("div",ne,n(o(_)(Y.value).format("hh:mm:ss a")),1),a("div",le,n(o(_)().format("D MMM, YYYY")),1)]),(v=o(h).data)!=null&&v.allow_geolocation_tracking?(c(),u(N,{key:0},[l.value?(c(),u("span",ie,n(l.value),1)):x("",!0),a("div",ce,[a("iframe",{width:"100%",height:"170",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0",style:{border:"0"},src:`https://maps.google.com/maps?q=${p.value},${f.value}&hl=en&z=15&output=embed`},null,8,re)])],64)):x("",!0),b(L,{variant:"solid",class:"w-full py-5 text-sm",onClick:i[0]||(i[0]=de=>H(y.value.action))},{default:d(()=>[D(n(o(t)("Confirm {0}",[y.value.label])),1)]),_:1})])]}),_:1},512)):x("",!0)],64)}}};export{fe as default};
//# sourceMappingURL=CheckInPanel-lzv_oJOk.js.map
