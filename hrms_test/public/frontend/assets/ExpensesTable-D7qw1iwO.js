var G=Object.defineProperty;var D=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var V=(t,i,l)=>i in t?G(t,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[i]=l,q=(t,i)=>{for(var l in i||(i={}))H.call(i,l)&&V(t,l,i[l]);if(D)for(var l of D(i))J.call(i,l)&&V(t,l,i[l]);return t};var F=(t,i,l)=>new Promise((v,w)=>{var d=u=>{try{r(l.next(u))}catch(f){w(f)}},o=u=>{try{r(l.throw(u))}catch(f){w(f)}},r=u=>u.done?v(u.value):Promise.resolve(u.value).then(d,o);r((l=l.apply(t,i)).next())});import{i as R,a as g,O as K,c as N,w as T,f as P,j as m,k as x,q as a,t as p,v as n,A as k,a5 as C,F as O,I as M,l as _,x as $,n as b,y as S}from"./frappe-ui-qLvTFYQB.js";import Q from"./FormField-BCSqEHey.js";import{_ as W}from"./index-CEKosOWR.js";import X from"./CustomIonModal-I51rBQrR.js";import{c as Y}from"./claims-Km0PudK6.js";import{f as I}from"./formatters-Ct4yxM4M.js";import"./Link-QcSLzh7C.js";const Z={class:"flex flex-row justify-between items-center mt-2"},ee={class:"text-base font-semibold text-gray-800"},te={class:"flex flex-row gap-3 items-center"},se={class:"text-base font-semibold text-gray-800"},ae={key:0,class:"flex flex-col bg-white mt-5 rounded border overflow-auto"},le=["onClick"],ne={class:"flex flex-col w-full justify-center gap-2.5"},oe={class:"flex flex-row items-center justify-between"},ie={class:"flex flex-row items-start gap-3 grow"},de={class:"flex flex-col items-start gap-1.5"},re={class:"text-base font-normal text-gray-800"},ce={class:"text-xs font-normal text-gray-500"},ue={key:0,class:"whitespace-nowrap"},me={class:"flex flex-row justify-end items-center gap-2"},pe={class:"text-gray-700 font-normal rounded text-base"},fe={class:"bg-white w-full flex flex-col items-center justify-center pb-5"},xe={class:"w-full pt-8 pb-5 border-b text-center"},ve={class:"text-gray-900 font-bold text-lg"},ye={class:"w-full flex flex-col items-center justify-center gap-5 p-4"},_e={class:"flex flex-col w-full space-y-4"},be={key:0,class:"flex w-full flex-row items-center justify-between gap-3"},Ie={__name:"ExpensesTable",props:{expenseClaim:{type:Object,required:!0},currency:{type:String,required:!0},isReadOnly:{type:Boolean,default:!1}},emits:["add-expense-item","update-expense-item","delete-expense-item"],setup(t,{emit:i}){const l=t,v=i,w=R("$dayjs"),d=R("$translate"),o=g({}),r=g(null),u=g(!1),f=g(!1),B=(c,s)=>F(this,null,function*(){c&&(o.value=q({},c),r.value=s),f.value=!0,u.value=!0}),U=()=>{v("delete-expense-item",r.value),j()},A=()=>{r.value===null?v("add-expense-item",o.value):v("update-expense-item",o.value,r.value),j()};function j(){f.value=!1,u.value=!1,o.value={},r.value=null}const E=K({url:"hrms.api.get_doctype_fields",params:{doctype:"Expense Claim Detail"},transform(c){const s=["description_sb","amounts_sb"];return c.filter(y=>!s.includes(y.fieldname))}});E.reload();const L=N(()=>l.isReadOnly?d("Expense Item"):r.value===null?d("New Expense Item"):d("Edit Expense Item")),z=N(()=>{var c;return(c=E.data)==null?void 0:c.some(s=>{if(s.reqd&&!o.value[s.fieldname])return!0})});return T(()=>o.value.expense_type,c=>{var s;o.value.description||(o.value.description=(s=Y[c])==null?void 0:s.description),o.value.cost_center=l.expenseClaim.cost_center}),T(()=>o.value.amount,c=>{f.value?f.value=!1:o.value.sanctioned_amount=parseFloat(c)}),(c,s)=>{const y=P("Button");return m(),x(O,null,[a("div",Z,[a("h2",ee,p(n(d)("Expenses")),1),a("div",te,[a("span",se,p(n(I)(t.expenseClaim.total_claimed_amount,t.currency)),1),t.isReadOnly?C("",!0):(m(),k(y,{key:0,id:"add-expense-modal",class:"text-sm",icon:"plus",variant:"subtle",onClick:s[0]||(s[0]=e=>B())}))])]),t.expenseClaim.expenses?(m(),x("div",ae,[(m(!0),x(O,null,M(t.expenseClaim.expenses,(e,h)=>(m(),x("div",{class:"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer",key:h,onClick:we=>B(e,h)},[a("div",ne,[a("div",oe,[a("div",ie,[a("div",de,[a("div",re,p(n(d)(e.expense_type)),1),a("div",ce,[a("span",null,p(n(d)("{0}: {1}",[n(d)("Sanctioned"),n(I)(e.sanctioned_amount||0,t.currency)])),1),s[4]||(s[4]=a("span",{class:"whitespace-pre"}," Â· ",-1)),e.expense_date?(m(),x("span",ue,p(n(w)(e.expense_date).format("D MMM")),1)):C("",!0)])])]),a("div",me,[a("span",pe,p(n(I)(e.amount,t.currency)),1),_(n($),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})])])])],8,le))),128))])):(m(),k(W,{key:1,message:"No expenses added",isTableField:!0})),_(X,{isOpen:u.value,onDidDismiss:s[3]||(s[3]=e=>j())},{actionSheet:b(()=>[a("div",fe,[a("div",xe,[a("span",ve,p(L.value),1)]),a("div",ye,[a("div",_e,[(m(!0),x(O,null,M(n(E).data,e=>(m(),k(Q,{key:e.fieldname,class:"w-full",label:n(d)(e.label,null,"Expense Claim Detail"),fieldtype:e.fieldtype,fieldname:e.fieldname,options:e.options,hidden:e.hidden,reqd:e.reqd,default:e.default,readOnly:e.read_only||t.isReadOnly,modelValue:o.value[e.fieldname],"onUpdate:modelValue":h=>o.value[e.fieldname]=h},null,8,["label","fieldtype","fieldname","options","hidden","reqd","default","readOnly","modelValue","onUpdate:modelValue"]))),128))]),t.isReadOnly?C("",!0):(m(),x("div",be,[r.value!==null?(m(),k(y,{key:0,class:"border-red-600 text-red-600 py-5 text-sm",variant:"outline",theme:"red",onClick:s[1]||(s[1]=e=>U())},{prefix:b(()=>[_(n($),{name:"trash",class:"w-4"})]),default:b(()=>[S(" "+p(n(d)("Delete")),1)]),_:1})):C("",!0),_(y,{variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white",onClick:s[2]||(s[2]=e=>A()),disabled:z.value},{prefix:b(()=>[_(n($),{name:r.value===null?"plus":"check",class:"w-4"},null,8,["name"])]),default:b(()=>[S(" "+p(r.value===null?n(d)("Add Expense"):n(d)("Update Expense")),1)]),_:1},8,["disabled"])]))])])]),_:1},8,["isOpen"])],64)}}};export{Ie as default};
//# sourceMappingURL=ExpensesTable-D7qw1iwO.js.map
